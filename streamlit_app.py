import streamlit as st
import pandas as pd
import math

st.set_page_config(page_title="Sauna Pro Calc 2026", layout="wide")

# --- –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –¢–ê–ë–õ–ò–¶–´ –†–ê–°–•–û–î–ù–ò–ö–û–í ---
if 'manual_items' not in st.session_state:
    st.session_state.manual_items = pd.DataFrame(
        [{"–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ": "–°–∞–º–æ—Ä–µ–∑—ã 4—Ö50", "–ö–æ–ª-–≤–æ": 1, "–¶–µ–Ω–∞": 500},
         {"–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ": "–ö–ª—è–π–º–µ—Ä—ã (—É–ø)", "–ö–æ–ª-–≤–æ": 5, "–¶–µ–Ω–∞": 350}],
    )

st.title("üå≤ –ü–æ–ª–Ω—ã–π —Ä–∞—Å—á–µ—Ç –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ –∏ —Ä–∞–±–æ—Ç")

# --- 1. –í–í–û–î –î–ê–ù–ù–´–• ---
with st.sidebar:
    st.header("üìê –†–∞–∑–º–µ—Ä—ã –ø–∞—Ä–Ω–æ–π (–º–º)")
    L = st.number_input("–ì–ª—É–±–∏–Ω–∞ (L)", value=2870)
    W = st.number_input("–®–∏—Ä–∏–Ω–∞ (W)", value=3500)
    H = st.number_input("–í—ã—Å–æ—Ç–∞ (H)", value=2600)
    st.divider()
    margin = st.slider("–ó–∞–ø–∞—Å –Ω–∞ –ø–æ–¥—Ä–µ–∑–∫—É (%)", 0, 20, 10) / 100 + 1

# –†–∞—Å—á–µ—Ç –ø–ª–æ—â–∞–¥–µ–π
s_walls = (2 * (L + W) * H) / 1_000_000
s_ceil = (L * W) / 1_000_000
s_total = s_walls + s_ceil

# --- 2. –†–ê–°–ß–ï–¢ –ú–ê–¢–ï–†–ò–ê–õ–û–í (–¢–ò–ü –í) ---
st.header("üì¶ –û—Å–Ω–æ–≤–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã")

col1, col2 = st.columns(2)

with col1:
    st.subheader("–°—Ç–µ–Ω—ã –∏ –ü–æ—Ç–æ–ª–æ–∫")
    vag_w = st.selectbox("–®–∏—Ä–∏–Ω–∞ –≤–∞–≥–æ–Ω–∫–∏ (–º–º)", [85, 95, 120, 135], index=3)
    insul_t = st.selectbox("–¢–æ–ª—â–∏–Ω–∞ —É—Ç–µ–ø–ª–∏—Ç–µ–ª—è (–º–º)", [50, 100], index=0)
    
    # –ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤
    vag_area_final = s_total * margin
    insulation_vol = (s_total * insul_t) / 1000
    foil_area = s_total * 1.15  # –ù–∞—Ö–ª–µ—Å—Ç 15%
    scotch_rolls = math.ceil(foil_area / 25) # 1 —Ä—É–ª–æ–Ω –Ω–∞ 25 –º2

with col2:
    st.subheader("–ü–æ–ª–∫–∏ –∏ –°–ø–∏–Ω–∫–∏")
    p_levels = st.number_input("–ö–æ–ª-–≤–æ —É—Ä–æ–≤–Ω–µ–π –ø–æ–ª–∫–æ–≤", 1, 3, 2)
    p_len = st.number_input("–û–±—â–∞—è –¥–ª–∏–Ω–∞ –ø–æ–ª–∫–æ–≤ (–º–º)", value=L+W)
    has_backrest = st.checkbox("–ù—É–∂–Ω—ã –ø–æ–¥—Å–ø–∏–Ω–Ω–∏–∫–∏?", value=True)
    
    # –ë—Ä—É—Å (—ç–º–ø–∏—Ä–∏—á–µ—Å–∫–∏–µ —Ñ–æ—Ä–º—É–ª—ã –∏–∑ –≤–∞—à–µ–≥–æ —Ñ–∞–π–ª–∞)
    # 40—Ö50: –ø—Ä–∏–º–µ—Ä–Ω–æ 2.5 –º.–ø. –Ω–∞ 1 –º2 –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–∏
    brus_40_50 = s_total * 2.5 
    # 20x40: –ø—Ä–∏–º–µ—Ä–Ω–æ 2 –º.–ø. –Ω–∞ 1 –º2 –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–∏
    brus_20_40 = s_total * 2
    # 45x90: –ø—Ä–∏–º–µ—Ä–Ω–æ 3 –º.–ø. –Ω–∞ 1 –º.–ø. –ø–æ–ª–∫–∞
    brus_45_90 = p_len / 1000 * 3 * p_levels

# --- 3. –¢–ê–ë–õ–ò–¶–ê –†–ï–ó–£–õ–¨–¢–ê–¢–û–í (–ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–ê–Ø) ---
st.subheader("üìã –õ–∏—Å—Ç –∑–∞–∫—É–ø–∫–∏ (–ê–≤—Ç–æ-—Ä–∞—Å—á–µ—Ç)")
auto_data = [
    ["–í–∞–≥–æ–Ω–∫–∞ (–º2)", round(vag_area_final, 2), 1600],
    ["–£—Ç–µ–ø–ª–∏—Ç–µ–ª—å (–º3)", round(insulation_vol, 2), 4500],
    ["–§–æ–ª—å–≥–∞ (–º2)", round(foil_area, 2), 150],
    ["–°–∫–æ—Ç—á –∞–ª—é–º–∏–Ω–∏–µ–≤—ã–π (—Ä—É–ª)", scotch_rolls, 450],
    ["–ë—Ä—É—Å 40—Ö50 (–º.–ø.)", round(brus_40_50, 1), 85],
    ["–ë—Ä—É—Å 20—Ö40 (–º.–ø.)", round(brus_20_40, 1), 45],
    ["–ë—Ä—É—Å 45—Ö90 (–º.–ø.)", round(brus_45_90, 1), 250],
]
df_auto = pd.DataFrame(auto_data, columns=["–ú–∞—Ç–µ—Ä–∏–∞–ª", "–ö–æ–ª-–≤–æ", "–¶–µ–Ω–∞ –∑–∞ –µ–¥."])
df_auto["–°—É–º–º–∞"] = df_auto["–ö–æ–ª-–≤–æ"] * df_auto["–¶–µ–Ω–∞ –∑–∞ –µ–¥."]
st.table(df_auto)

# --- 4. –¢–ê–ë–õ–ò–¶–ê –†–ê–°–•–û–î–ù–ò–ö–û–í (–†–£–ß–ù–û–ô –í–í–û–î) ---
st.header("üîß –ü—Ä–æ—á–∏–µ —Ä–∞—Å—Ö–æ–¥–Ω–∏–∫–∏ (–≤–ø–∏—Å–∞—Ç—å –≤—Ä—É—á–Ω—É—é)")
st.caption("–ó–¥–µ—Å—å –≤—ã –º–æ–∂–µ—Ç–µ –¥–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–∏–∑—ã, –ø–µ–Ω—É, –≥–µ—Ä–º–µ—Ç–∏–∫–∏ –∏ –ø—Ä–æ—á–µ–µ. –ù–∞–∂–º–∏—Ç–µ –¥–≤–∞–∂–¥—ã –Ω–∞ —è—á–µ–π–∫—É, —á—Ç–æ–±—ã –∏–∑–º–µ–Ω–∏—Ç—å.")
edited_manual = st.data_editor(st.session_state.manual_items, num_rows="dynamic", use_container_width=True)
st.session_state.manual_items = edited_manual

manual_total = (edited_manual["–ö–æ–ª-–≤–æ"] * edited_manual["–¶–µ–Ω–∞"]).sum()

# --- –ò–¢–û–ì–û ---
st.divider()
final_sum = df_auto["–°—É–º–º–∞"].sum() + manual_total
c1, c2 = st.columns(2)
c1.metric("–ò–¢–û–ì–û –ú–ê–¢–ï–†–ò–ê–õ–´", f"{final_sum:,.0f} —Ä—É–±.")
c2.info(f"–í–∫–ª—é—á–∞—è —Ä—É—á–Ω–æ–π –≤–≤–æ–¥ –Ω–∞ —Å—É–º–º—É: {manual_total:,.0f} —Ä—É–±.")

# –ö–Ω–æ–ø–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞
if st.button("üìÑ –ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å —Å–º–µ—Ç—É –¥–ª—è WhatsApp"):
    msg = f"–°–º–µ—Ç–∞ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ –¥–ª—è –ø–∞—Ä–Ω–æ–π {L}x{W}:\n"
    for i, row in df_auto.iterrows():
        msg += f"- {row['–ú–∞—Ç–µ—Ä–∏–∞–ª']}: {row['–ö–æ–ª-–≤–æ']}\n"
    msg += f"\n–ò—Ç–æ–≥–æ: {final_sum:,.0f} —Ä—É–±."
    st.text_area("–ì–æ—Ç–æ–≤—ã–π —Ç–µ–∫—Å—Ç:", msg, height=200)
