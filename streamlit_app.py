import streamlit as st
import pandas as pd
import math

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
st.set_page_config(page_title="–ú–∞—Å—Ç–µ—Ä –°–∞—É–Ω: –ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π –†–∞—Å—á–µ—Ç", layout="wide")

# –ó–∞–≥–æ–ª–æ–≤–æ–∫
st.title("üèó –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –æ—Ç–¥–µ–ª–∫–∏: –ü–∞—Ä–Ω–∞—è, –ü–æ–ª–∫–∏, –ü–µ—á—å")

# --- –ë–õ–û–ö 1: –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ù–ê–°–¢–†–û–ô–ö–ò (–ë–û–ö–û–í–ê–Ø –ü–ê–ù–ï–õ–¨) ---
with st.sidebar:
    st.header("üìç –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –æ–±—ä–µ–∫—Ç–∞")
    client_name = st.text_input("–ò–º—è –∫–ª–∏–µ–Ω—Ç–∞ / –û–±—ä–µ–∫—Ç", "–ó–∞–∫–∞–∑ ‚Ññ1")
    
    st.subheader("–†–∞–∑–º–µ—Ä—ã –ø–æ–º–µ—â–µ–Ω–∏—è (–º–º)")
    L = st.number_input("–ì–ª—É–±–∏–Ω–∞ (–ì)", value=2870, step=10)
    W = st.number_input("–®–∏—Ä–∏–Ω–∞ (–®)", value=3500, step=10)
    H = st.number_input("–í—ã—Å–æ—Ç–∞ (–í)", value=2600, step=10)
    
    st.divider()
    dist = st.number_input("–†–∞—Å—Å—Ç–æ—è–Ω–∏–µ (–∫–º)", value=0)
    gsm_price = st.number_input("–¶–µ–Ω–∞ –±–µ–Ω–∑–∏–Ω–∞ (—Ä—É–±/–ª)", value=65)

# –†–∞—Å—á–µ—Ç –ø–ª–æ—â–∞–¥–µ–π (–≤ –º–µ—Ç—Ä–∞—Ö)
s_walls = (2 * (L + W) * H) / 1_000_000
s_ceiling = (L * W) / 1_000_000
s_total = s_walls + s_ceiling

st.info(f"üìä **–ü–ª–æ—â–∞–¥—å –ø–æ–¥ –æ—Ç–¥–µ–ª–∫—É:** –°—Ç–µ–Ω—ã {s_walls:.2f} –º¬≤, –ü–æ—Ç–æ–ª–æ–∫ {s_ceiling:.2f} –º¬≤")

# --- –ë–õ–û–ö 2: –ü–û–õ–ö–ò (–î–ï–¢–ê–õ–¨–ù–´–ô –†–ê–°–ß–ï–¢) ---
st.header("ü™µ –†–∞—Å—á–µ—Ç –ø–æ–ª–∫–æ–≤")
num_levels = st.radio("–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—Ä–æ–≤–Ω–µ–π –ø–æ–ª–∫–æ–≤", [1, 2, 3], horizontal=True, index=1)

shelves_summary = []
col_sh = st.columns(num_levels)

for i in range(num_levels):
    with col_sh[i]:
        st.subheader(f"–£—Ä–æ–≤–µ–Ω—å {i+1}")
        sh_len = st.number_input(f"–î–ª–∏–Ω–∞ (–º–º)", value=L if i==0 else W, key=f"slen_{i}")
        sh_width = st.number_input(f"–®–∏—Ä–∏–Ω–∞ (–º–º)", value=800 if i==0 else 400, key=f"swid_{i}")
        board_w = st.selectbox(f"–î–æ—Å–∫–∞ –ø–æ–ª–∫–∞", [95, 120, 140], index=0, key=f"sbw_{i}")
        
        # –¢–æ—Ä—Ü–µ–≤—ã–µ –¥–æ—Å–∫–∏ (–∑–∞—à–∏–≤–∫–∞ —Å–ø–µ—Ä–µ–¥–∏)
        end_boards = st.selectbox("–¢–æ—Ä—Ü–µ–≤—ã–µ –¥–æ—Å–∫–∏ (—à—Ç)", [0, 1, 2], index=1, key=f"seb_{i}")
        
        # –†–∞—Å—á–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –¥–æ—Å–æ–∫ (—Å —É—á–µ—Ç–æ–º –∑–∞–∑–æ—Ä–∞ 5–º–º)
        gap = 5
        count_top = math.ceil(sh_width / (board_w + gap))
        total_boards = count_top + end_boards
        
        st.write(f"–ù–∞—Å—Ç–∏–ª: {count_top} —à—Ç.")
        st.write(f"–¢–æ—Ä—Ü–µ–≤—ã–µ: {end_boards} —à—Ç.")
        st.success(f"–ò—Ç–æ–≥–æ: {total_boards} —à—Ç.")
        
        shelves_summary.append({
            "–£—Ä–æ–≤–µ–Ω—å": i+1,
            "–î–ª–∏–Ω–∞": sh_len,
            "–®–∏—Ä–∏–Ω–∞": sh_width,
            "–ö–æ–ª-–≤–æ –¥–æ—Å–æ–∫": total_boards
        })

# --- –ë–õ–û–ö 3: –ü–ï–ß–¨ –ò –î–´–ú–û–•–û–î ---
st.header("üî• –ü–µ—á—å –∏ –î—ã–º–æ—Ö–æ–¥")
c_p1, c_p2 = st.columns(2)

with c_p1:
    stove_type = st.selectbox("–í–∞—Ä–∏–∞–Ω—Ç –ø–µ—á–∏", [
        "–ü–µ—á—å –¥—Ä–æ–≤—è–Ω–∞—è (–Ω–µ—Ä–∂. —Å—Ç–∞–ª—å)", 
        "–ü–µ—á—å —á—É–≥—É–Ω–Ω–∞—è", 
        "–ü–µ—á—å —ç–ª–µ–∫—Ç—Ä–∏—á–µ—Å–∫–∞—è",
        "–ü–µ—á—å –≥–∞–∑–æ–≤–∞—è"
    ])
    portal = st.checkbox("–ö–∏—Ä–ø–∏—á–Ω—ã–π –ø–æ—Ä—Ç–∞–ª (–º–æ–Ω—Ç–∞–∂)")
    fence = st.checkbox("–û–≥—Ä–∞–∂–¥–µ–Ω–∏–µ –ø–µ—á–∏ (–º–æ–Ω—Ç–∞–∂)")
    stones = st.checkbox("–û—Ç–º—ã–≤–∫–∞ –∏ —É–∫–ª–∞–¥–∫–∞ –∫–∞–º–Ω–µ–π")

with c_p2:
    chimney = st.toggle("–ù—É–∂–µ–Ω –¥—ã–º–æ—Ö–æ–¥")
    if chimney:
        chimney_class = st.radio("–ö–ª–∞—Å—Å –¥—ã–º–æ—Ö–æ–¥–∞", ["–≠–∫–æ–Ω–æ–º", "–°—Ç–∞–Ω–¥–∞—Ä—Ç", "–ü—Ä–µ–º–∏—É–º"])
        chimney_h = st.number_input("–í—ã—Å–æ—Ç–∞ –¥—ã–º–æ—Ö–æ–¥–∞ (–º)", value=4.5, step=0.5)

# --- –ë–õ–û–ö 4: –ò–¢–û–ì–û–í–ê–Ø –¢–ê–ë–õ–ò–¶–ê –†–ê–ë–û–¢ ---
st.header("üõ† –°–º–µ—Ç–∞ –Ω–∞ —Ä–∞–±–æ—Ç—ã")

# –§–æ—Ä–º–∏—Ä—É–µ–º —Å–ø–∏—Å–æ–∫ —Ä–∞–±–æ—Ç –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤–∞—à–∏—Ö —Ü–µ–Ω –∏–∑ —Ñ–∞–π–ª–∞
works_list = [
    {"–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ": "–û–±—Ä–µ—â—ë—Ç–∫–∞ / –∫–∞—Ä–∫–∞—Å –º–æ–Ω—Ç–∞–∂", "–ö–æ–ª-–≤–æ": s_total, "–ï–¥.": "–º2", "–¶–µ–Ω–∞": 1200},
    {"–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ": "–ü–∞—Ä–æ–∏–∑–æ–ª—è—Ü–∏—è –º–æ–Ω—Ç–∞–∂", "–ö–æ–ª-–≤–æ": s_total, "–ï–¥.": "–º2", "–¶–µ–Ω–∞": 500},
    {"–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ": "–£–∫–ª–∞–¥–∫–∞ —É—Ç–µ–ø–ª–µ–Ω–∏—è", "–ö–æ–ª-–≤–æ": s_total, "–ï–¥.": "–º2", "–¶–µ–Ω–∞": 500},
    {"–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ": "–ú–æ–Ω—Ç–∞–∂ –≤–∞–≥–æ–Ω–∫–∏", "–ö–æ–ª-–≤–æ": s_total, "–ï–¥.": "–º2", "–¶–µ–Ω–∞": 1650},
    {"–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ": "–ú–æ–Ω—Ç–∞–∂ –ø–æ–ª–∫–æ–≤ (–∫–æ–º–ø–ª–µ–∫—Ç)", "–ö–æ–ª-–≤–æ": 1, "–ï–¥.": "–∫–æ–º–ø–ª", "–¶–µ–Ω–∞": 35000},
]

# –î–æ–±–∞–≤–ª—è–µ–º –¥–æ–ø. —Ä–∞–±–æ—Ç—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤—ã–±–æ—Ä–∞
if portal:
    works_list.append({"–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ": "–ò–∑–≥–æ—Ç–æ–≤–ª–µ–Ω–∏–µ –ø–æ—Ä—Ç–∞–ª–∞ –ø–µ—á–∏", "–ö–æ–ª-–≤–æ": 1, "–ï–¥.": "—à—Ç", "–¶–µ–Ω–∞": 18000})
if stones:
    works_list.append({"–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ": "–ö–∞–º–Ω–∏ –æ—Ç–º—ã—Ç—å –∏ —É–ª–æ–∂–∏—Ç—å", "–ö–æ–ª-–≤–æ": 1, "–ï–¥.": "—à—Ç", "–¶–µ–Ω–∞": 2500})
if chimney:
    works_list.append({"–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ": "–ú–æ–Ω—Ç–∞–∂ –¥—ã–º–æ—Ö–æ–¥–∞", "–ö–æ–ª-–≤–æ": 1, "–ï–¥.": "—à—Ç", "–¶–µ–Ω–∞": 15000})

# –°–æ–∑–¥–∞–µ–º DataFrame (—Ç–µ–ø–µ—Ä—å –±–µ–∑ –æ—à–∏–±–∫–∏ pd)
df_works = pd.DataFrame(works_list)
df_works['–ò—Ç–æ–≥–æ (—Ä—É–±)'] = df_works['–ö–æ–ª-–≤–æ'] * df_works['–¶–µ–Ω–∞']

st.table(df_works)

# –ò—Ç–æ–≥
total_works = df_works['–ò—Ç–æ–≥–æ (—Ä—É–±)'].sum()
st.subheader(f"–ò—Ç–æ–≥–æ–≤–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å —Ä–∞–±–æ—Ç: {total_works:,.0f} —Ä—É–±.")

# –ö–Ω–æ–ø–∫–∞ –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è
if st.button("üì± –ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å —Ç–µ–∫—Å—Ç –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞"):
    text = f"–†–∞—Å—á–µ—Ç –æ—Ç–¥–µ–ª–∫–∏ –ø–∞—Ä–Ω–æ–π ({client_name}):\n"
    text += f"–†–∞–∑–º–µ—Ä—ã: {L}x{W}x{H} –º–º\n"
    text += f"–ü–æ–ª–∫–∏: {num_levels} —É—Ä. ({shelves_summary[0]['–®–∏—Ä–∏–Ω–∞']}–º–º)\n"
    text += f"–ü–µ—á—å: {stove_type}\n"
    text += f"–ò–¢–û–ì–û –†–ê–ë–û–¢–´: {total_works:,.0f} —Ä—É–±."
    st.text_area("–°–∫–æ–ø–∏—Ä—É–π—Ç–µ —ç—Ç–æ:", text)
